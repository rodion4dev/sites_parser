# API на Flask для парсинга сайтов

Построен на Celery очередях, где в качестве брокера и базы данных с результатами выступает Redis (номера баз разъеденены; 0 - очереди, 1 - результаты). Разделение проекта на два Python пакета было сделано целенаправленно по принципу "1 PID per container".

## Разработка

### Требования
* Docker Engine 19.03.0+
* docker-compose

### Запуск
```shell script
docker-compose build
docker-compose up
```

### Интерфейс

**Путь**: `http://localhost:5000/`

## Боевая среда

### Требования
* Python (проверено на 3.8 версии)
* Redis сервер (проверено на 6.0)
* Зависимости из requirements.txt
* Установленные переменные окружения из .example.api.env b .celery.env

## REST интерфейс проекта

### Получение информации о задаче

**URL** : `/task/:identifier`

**URL параметры** : `identifier=[uuid], где identifier - уникальный идентификатор задачи`

**Метод** : `GET`

#### Успешный ответ

**Код ответа** : `200 OK`

**Пример ответа** :

```json
{
    "children": [],
    "date_done": "2020-08-07T08:14:37.134388",
    "result": "http://localhost:5000/639d4529-a66f-41f2-ab1a-f8f17028fe04.tar.gz",
    "status": "SUCCESS",
    "task_id": "639d4529-a66f-41f2-ab1a-f8f17028fe04",
    "traceback": null
}
```

#### Ресурс не найден

**Код ответа** : `404 Not Found`

**Пример ответа** :

```json
{
    "error": "Задача не найдена."
}
```

#### Ошибка на стороне сервера

**Код ответа** : `500 Internal Server Error`

**Пример ответа** :

```json
{
    "error": "Ошибка на стороне сервера, попробуйте позже."
}
```

### Создание задачи

**URL** : `/task`

**URL параметры** : `None`

**Метод** : `POST`

#### Успешный ответ

**Код ответа** : `201 Created`

**Пример ответа** :

```json
{
    "identifier": "639d4529-a66f-41f2-ab1a-f8f17028fe04"
}
```

#### URL некорректный

**Код ответа** : `400 Bad Request`

**Пример ответа** :

```json
{
    "error": "Указанный URL некорректный."
}
```
